{% load staticfiles %}
<!-- How To section --> 
    <section class="for-full-back color-white" id="howto">
        <div class="container">
            <div class="row text-center">
                <div class="col-md-8 col-md-offset-2">
                    <h1>a description & a how to</h1>
                </div>
            </div>
            <p> Here follows a short description the relational (meta)database interface and the steps one need to take to add, update or remove data. 
            </p>

            <p>
            We will first briefly discuss the database structure, the various tables it contains and what they and their respective fields represent.

            Afterwards, there is a brief description of how to explore the data already added, followed by descriptions of how to add files, new drives and sensors to the system. We will finish by how to create a back-up.  

            </p>

            <div class="row text-center">
                <div class="col-md-8 col-md-offset-2">
                    <b> DISCLAIMER </b>
                     <p>
                        <i>It is possibly good to note here that the interface is quite basic; it heavily relies on the <a href="/admin/">admin site</a> automatically generated by Django to add and alter data, since there was not enough time to create a reliable custom made interface. As a consequence, some of the steps described below might prove rather cumbersome. My apologies for this. </i></p>
                </div>
            </div>
             
            <h2>1. The Database Structure</h2>
            
            <p>
            The SQLite database (stored in the main folder under the name <samp>kumbhmela_db.sqlite3</samp>) consists of 10 different tables to keep track of the data. See for a graphical representation of the database the figure below. 
        </p>

            <p>
            Before we start with a description of the various tables and the meaning of their fields, it might be good to note that we distinguish here between something called a 'Drive' and a 'DriveCopy'. The former can refer to either 1) an external hard drive, or 2) a 'unique' drive in the PegasusR6. Recall that each file added to the PegasusR6 system is stored on two drives simulatenously since it is configured in <a href="https://www.wikiwand.com/en/Standard_RAID_levels">RAID1</a>. In order to avoid having duplicate drives in the database, we added the 'DriveCopy' table; each 'Drive' in the PegasusR6 is associated with two DriveCopies. So a 'Drive' represents one real phyiscal hard-drive in case of an external hard-drive, but it represents two physical hard-drives in the case of a PegasusR6 drive. It might not be the most intuitive representation, but we avoid having to maintain duplicates of drives in the database, e.g., if we want to know what is on a particular 'DriveCopy' in the PegasusR6, we can simply look at the files contained on the linked 'Drive'.
            </p>
            <p>
            Here follows a list of the tables in the database. Fields that are necessary/required are denoted with an asterisk (*). Foreign keys are represented with (FK). 
            <ol>
                <li><b><a href="/Drive/list">Drive</a></b> - this table contains all the distinct hard-drives:</li>
                    <ul>
                        <li>
                            label (*) - the name of the hard-drive (e.g., 'kumbhmela_1').
                        </li>
                        <li>
                            external (*) - Boolean field. It is true when the drive is an external hard-drive and false otherwise.
                        </li>
                        <li>
                            time_added - time when the drive was added to the database.
                        </li>
                        <li>
                            time_removed - time when the drive was removed from the database.
                        </li>
                        <li>
                            whereabouts - can contain some notes on where the drive is now.
                        </li>
                        <li>
                            note - some additional notes.
                        </li>
                    </ul>
                <li><b><a href="/DriveCopy/list">DriveCopy</a></b> - a table for the duplicate drives in the PegasusR6:</li>
                    <ul>
                        <li>
                            drive (* | FK) - the drive this drive a copy of. 
                        </li>
                        <li>
                            label (*) - the label attached to the phyisical drive. 
                        </li>
                        <li>
                            number (*) - number of this copy.
                        </li>
                        <li>
                            whereabouts - can contain some notes on where the drive is now.
                        </li>
                        <li>
                            note - some additional notes.
                        </li>
                    </ul>
                <li><b><a href="/Person/list">Person</a></b> - a table for the experiment leaders:</li>
                    <ul>
                        <li>
                           name (*) - name of the person. 
                        </li>
                        <li>
                            email - his/her email address. 
                        </li>
                        <li>
                            note - might contain some other contact information.
                        </li>
                    </ul>
                 <li><b><a href="/Experiment/list">Experiment</a></b> - a table for the various subexperiments in the Kumbh Mela experiment:</li>
                    <ul>
                        <li>
                           contactperson (* | FK) - the experiment leader. 
                        </li>
                        <li>
                            name (*) - name of the subexperiment. 
                        </li>
                        <li>
                            number (*) - number associated with the experiment. 
                        </li>
                        <li>
                            description - short description of the subexperiment.
                        </li>
                        <li>
                            note - some additional notes.
                        </li>
                    </ul>
                <li><b><a href="/Format/list">Format</a></b> - this table contains a list of all the custom file formats and a description of how they are structured:</li>
                    <ul>
                        <li>extension (*) - file extension; starts with a point, no capitals, e.g., '.txt'.</li>
                        <li>description - description of the file format (max. number of characters: 10,000).</li>
                    </ul>
                <li><b><a href="/Location/list">Location</a></b> - this table contains locations used by sensors:</li>
                    <ul>
                        <li>latitude.</li>
                        <li>longitude.</li>
                        <li>description - some additional notes on the location. E.g., for cameras, one might want to add its orientation as well.</li>
                    </ul>
                <li><b><a href="/Sensor/list">Sensor</a></b> - this table contains all the different sensors used in the experiments (e.g., 'GoPro Camera Hero4 No. 1'). This allows one to link files with a particular sensor:</li>
                    <ul>
                        <li>sensor_type (*) - type of sensor, e.g., 'GoPro Camera Hero 4 Silver'.</li>
                        <li>format (FK) - format of files generated by this sensor.</li>
                        <li>location (FK) - where the sensor was placed.</li>
                        <li>note - additional notes (max. number of characters: 1,000).</li>
                    </ul>
                <li><b><a href="/Source/list">Source</a></b> - table containing the various data sources, e.g., the local police:</li>
                    <ul>
                        <li>name (*) - name of the data source.</li>
                        <li>note - additional notes.</li>
                    </ul>
                <li><b><a href="/File/list">File</a></b> - the main table of this database containing all the file records:</li>
                    <ul>
                        <li>drive (* | FK) - the drives this file is stored on.</li>
                        <li>format (FK) - the format of the file.</li>
                        <li>experiment (FK) - the subexperiments this file belongs to.</li>
                        <li>source (FK) - the data source this file is coming from.</li>
                        <li>sensor (FK) - the sensor that generated the data in this file.</li>
                        <li>location (FK) - where the data in this file was recorded.</li>
                        <li>time_added - time that the file was added to the database.</li>
                        <li>size - the size of the file in bytes.</li>
                        <li>start_recording - the time when the recording started.</li>
                        <li>end_recording - the time when the recording ended.</li> 
                        <li>note - additional notes.</li>
                    </ul>
                <li><b><a href="/StorageLocation/list">StorageLocation</a></b> - a table that links files and drives. It tells you on which drives and and where on the drives all the files are stored.</li>
                    <ul>
                        <li>drive (* | FK) - the drive.</li>
                        <li>file (* | FK) - the file.</li>
                        <li>path (*) - the path of the file on the given drive.</li>
                    </ul>
            </ol> 
            </p>

            See the figure below for a graphical representation of the database and the relations between the various tables. <samp>PK</samp> and <samp>FK</samp> stand for 'primary key' and 'foreign key', respectively. 
            <div class="row text-center">
                <img src="{% static 'img/SQLdiagram_kumbhmela.svg' %}" alt="Database architecture" style="width:60%">
            </div>


            <h2>2. Accessing the Admin Site</h2>

            Normally you would not find a section on a website about how to access the admin site, especially not with the username and password explicitly written down. Since this site is not going to be online (it will only run locally in the server room), there is no danger to put this here:

            <p>
             <div class="row text-center">
                <div class="col-md-8 col-md-offset-2">
                    <b> USERNAME: </b> <samp>kumbhmela</samp><br>
                    <b> PASSWORD: </b> <samp>pepernoten</samp>
                </div>
            </div>
            </p>

            By clicking <a href="/admin">here</a> and filling in the username and password, you can access the admin part of the site.


            <h2>3. Exploring the data</h2>
            <p>
                One can explore the data already stored in the database in several ways: 
                <ul>
                    <li>
                        Go to the <a href="/admin">admin site</a>, log in and explore the data.
                    </li>
                    <li>
                        One can explore the various tables <a href="/#tables">here</a>. Each link shows the different entries for that table. It also allows you to search and order it by column. 
                    </li>
                    <li>
                        Click <a href="/#experiments">here</a> if you want to explore the files associated with a particular experiment. 
                    </li>
                    <li>
                        Alternatively, if you want to see the files on a particular drive, click <a href="/#drives">here</a>.
                    </li>
                    <li>
                        For finding the files coming from a specific source, click <a href="/#sources">here</a>.
                    </li>
                    <li>
                        For listing all files generated by a specific sensor, click <a href="/#sensors">here</a>.
                    </li>
                </ul>
            </p>


            <h2>4. Adding a File</h2>
             
            In case you want to register a new file to the (meta)database:

            <ol>
                <li>Go to the <a href="/admin">admin site</a>.</li>
                <li>Login.
                <li>Click on 'add' next to Files and fill in the form.</li>
                <li>At the end of the site, there is a subform called 'Storage Locations'. Here one can add separate drives and add a path to the file for each drive. Setting up the system like this allows for the same file to be on different locations on different drives. This might be a bit cumbersome, but I thought it was the easiest and safest solution in the given time.</li>
            </ol>

            <h2>5. Adding a Drive</h2>
                
            <p>Simply click <a href="/drive/new">here</a> and fill in the form. Select the option 'external' when the new drive is an external hard-drive. Otherwise, the drive is thought to be a new drive for the PegasusR6. <b>NOTE:</b> make sure to add a proper label to the drive, which makes it easier to keep them apart. 

            <h2>6. Adding New Sensors</h2>
            
            Click on the link <a href="/sensor/new">here</a> and fill in the form. The form allows you to add a large number of sensors of the same type. 

            <h2>7. Creating a Back-up</h2>

            In order to back-up the (meta)database, follow the following steps:
            <ol>
                <li>Go to the main directory of the repository and locate the file <samp>kumbhmela_db.sqlite3</samp>. This file contains all (meta)data. </li>
                <li>Copy the file to a thumb drive (or mail it).</li>
                <li>Make sure to make a note about the time of the back-up. Otherwise is might be hard to afterwards figure out which back-up was which. </li>
            </ol>

            

        </div>



    </section>